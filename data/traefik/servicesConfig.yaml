http:
  routers:

    ksmi-site:
      rule: "Host(`{{env "SITE_TRAEFIK_HOST"}}`)"
      service: ksmi-service
      entryPoints:
        - "websecure"
      tls:
        certresolver:
          - "mydnschallenge"

    adguard:
      rule: "Host(`{{env "ADGUARD_TRAEFIK_HOST"}}`)"
      service: adguard-service
      entryPoints:
        - "websecure"
      tls:
        certresolver:
          - "mydnschallenge"

    plex:
      rule: "Host(`{{env "PLEX_TRAEFIK_HOST"}}`)"
      service: plex-service
      entryPoints:
        - "websecure"
      tls:
        certresolver:
          - "mydnschallenge"

    homer:
      rule: "Host(`{{env "HOMER_TRAEFIK_HOST"}}`)"
      service: homer-service
      middlewares:
        - local-white-list
      entryPoints:
        - "websecure"
      tls:
        certresolver:
          - "mydnschallenge"

    duplicati:
      rule: "Host(`{{env "DUPLICATI_TRAEFIK_HOST"}}`)"
      service: duplicati-service
      middlewares:
        - local-white-list
      entryPoints:
        - "websecure"
      tls:
        certresolver:
          - "mydnschallenge"

  services:
    ksmi-service:
      loadBalancer:
        servers:
          - url: "http://ksmi_site:3000"
    adguard-service:
      loadBalancer:
        servers:
          - url: "http://adguard:80"
    plex-service:
      loadBalancer:
        servers:
          - url: "http://plex:32400"
#          - url: "http://plex:32469"
#          - url: "http://plex:1900"
    homer-service:
      loadBalancer:
        servers:
          - url: "http://homer:8080"
    duplicati-service:
      loadBalancer:
        servers:
          - url: "http://duplicati:8200"


  middlewares:
    local-white-list:
      ipwhitelist:
        sourcerange:
          - "192.168.0.0/24"
          - "10.13.13.0/24"
          - "127.0.0.1/32"

